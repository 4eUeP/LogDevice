<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Running on Kubernetes · LogDevice</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="This document describes how to run LogDevice kubernetes using the specs that we provide. The document assumes basic previous kubernetes knowledge. By the end of this section, you&#x27;ll have a fully running LogDevice cluster on kubernetes that&#x27;s ready to receive reads/writes."/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Running on Kubernetes · LogDevice"/><meta property="og:type" content="website"/><meta property="og:url" content="https://logdevice.io/index.html"/><meta property="og:description" content="This document describes how to run LogDevice kubernetes using the specs that we provide. The document assumes basic previous kubernetes knowledge. By the end of this section, you&#x27;ll have a fully running LogDevice cluster on kubernetes that&#x27;s ready to receive reads/writes."/><meta property="og:image" content="https://logdevice.io/img/logdevice_og.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://logdevice.io/img/logdevice.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css"/><link rel="alternate" type="application/atom+xml" href="https://logdevice.io/blog/atom.xml" title="LogDevice Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://logdevice.io/blog/feed.xml" title="LogDevice Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-137238014-1', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,700"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/facebook_logdevice_whitewordmark.png" alt="LogDevice"/></a><a href="/versions.html"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/next/Overview.html" target="_self">Docs</a></li><li class=""><a href="/api/annotated.html" target="_self">API</a></li><li class=""><a href="/help.html" target="_self">Support</a></li><li class=""><a href="https://github.com/facebookincubator/LogDevice" target="_self">GitHub</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Configuration</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Getting started<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/Overview.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/next/LocalCluster.html">Quickstart</a></li><li class="navListItem"><a class="navItem" href="/docs/next/Concepts.html">Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/next/Installation.html">Build LogDevice</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Configuration<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/FirstCluster.html">Creating your first cluster</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/next/Kubernetes.html">Running on Kubernetes</a></li><li class="navListItem"><a class="navItem" href="/docs/next/Config.html">Cluster configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/next/Settings.html">Settings</a></li><li class="navListItem"><a class="navItem" href="/docs/next/Logs.html">Log configuration</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Administration<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/administration/AdminServer.html">Admin Server (Control Plane)</a></li><li class="navListItem"><a class="navItem" href="/docs/next/administration/LDShell.html">LogDevice Shell</a></li><li class="navListItem"><a class="navItem" href="/docs/next/administration/LDQuery.html">LDQuery</a></li><li class="navListItem"><a class="navItem" href="/docs/next/administration/ClusterMaintenance.html">Cluster Maintenance</a></li><li class="navListItem"><a class="navItem" href="/docs/next/administration/SafetyChecker.html">Operations Safety Checker</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Concepts<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/Writepath.html">Write path</a></li><li class="navListItem"><a class="navItem" href="/docs/next/ReadPath.html">Read path</a></li><li class="navListItem"><a class="navItem" href="/docs/next/Terminology.html">Terminology</a></li><li class="navListItem"><a class="navItem" href="/docs/next/Consensus.html">Distributed consensus</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Designs<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/FailureDetection.html">Failure detection</a></li><li class="navListItem"><a class="navItem" href="/docs/next/Replication.html">Log replication configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/next/Recovery.html">Recovery after the failure of a sequencer</a></li><li class="navListItem"><a class="navItem" href="/docs/next/TrafficShaping.html">Traffic shaping</a></li><li class="navListItem"><a class="navItem" href="/docs/next/Rebuilding.html">Rebuilding</a></li><li class="navListItem"><a class="navItem" href="/docs/next/LogsDB.html">LogsDB</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">API<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/API_Introduction.html">Client library API</a></li><li class="navListItem"><a class="navItem" href="/docs/next/API_Doxygen.html">Reference</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Extending LogDevice<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/WritingPlugins.html">Writing plugins</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Running on Kubernetes</h1></header><article><div><span><p>This document describes how to run LogDevice kubernetes using the specs that we provide. The document assumes basic previous kubernetes knowledge. By the end of this section, you'll have a fully running LogDevice cluster on kubernetes that's ready to receive reads/writes.</p>
<h2><a class="anchor" aria-hidden="true" id="1-building-your-kubernetes-cluster"></a><a href="#1-building-your-kubernetes-cluster" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. Building your Kubernetes Cluster</h2>
<p>The first step is to have a running kubernetes cluster. You can use a managed cluster (provided by your cloud provider), a self-hosted cluster or a local kubernetes cluster using a tool like <a href="https://github.com/kubernetes/minikube">minikube</a>. Make sure that <code>kubectl</code> points to whatever cluster you're planning to use.</p>
<h2><a class="anchor" aria-hidden="true" id="2-install-zookeeper"></a><a href="#2-install-zookeeper" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. Install Zookeeper</h2>
<p>LogDevice depends on Zookeeper for storing per-log metadata and its nodes configuration. So we will need to provision a zookeeper ensemble that LogDevice will be able to access. For this demo, we will use <a href="https://helm.sh/">helm</a> (A package manager for kubernetes) to install zookeeper. After installing helm run:</p>
<pre><code class="hljs css language-shell-session">helm repo <span class="hljs-keyword">add</span> incubator http://<span class="hljs-keyword">storage</span>.googleapis.com/kubernetes-charts-incubator
helm repo <span class="hljs-keyword">update</span>
helm install zookeeper incubator/zookeeper
</code></pre>
<pre><code class="hljs css language-shell-session"><span class="hljs-string">NAME:</span> zookeeper
LAST <span class="hljs-string">DEPLOYED:</span> Fri Dec <span class="hljs-number">20</span> <span class="hljs-number">14</span>:<span class="hljs-number">19</span>:<span class="hljs-number">41</span> <span class="hljs-number">2019</span>
<span class="hljs-string">NAMESPACE:</span> <span class="hljs-keyword">default</span>
<span class="hljs-string">STATUS:</span> deployed
<span class="hljs-string">REVISION:</span> <span class="hljs-number">1</span>
TEST <span class="hljs-string">SUITE:</span> None
<span class="hljs-string">NOTES:</span>
Thank you <span class="hljs-keyword">for</span> installing ZooKeeper on your Kubernetes cluster. More information
about ZooKeeper can be found at <span class="hljs-string">https:</span><span class="hljs-comment">//zookeeper.apache.org/doc/current/</span>

Your connection string should look <span class="hljs-string">like:</span>
  zookeeper<span class="hljs-number">-0.</span>zookeeper-<span class="hljs-string">headless:</span><span class="hljs-number">2181</span>,zookeeper<span class="hljs-number">-1.</span>zookeeper-<span class="hljs-string">headless:</span><span class="hljs-number">2181</span>,...

  You can also use the client service <span class="hljs-string">zookeeper:</span><span class="hljs-number">2181</span> to connect to an available ZooKeeper server.

</code></pre>
<blockquote>
<p>Take note of the printed zookeeper connection string, we will use it later on.</p>
</blockquote>
<p>This will by default install a 3 nodes zookeeper ensemble. Wait until all the three pods are marked as ready:</p>
<pre><code class="hljs css language-shell-session">kubectl <span class="hljs-builtin-name">get</span> pods
</code></pre>
<pre><code class="hljs css language-shell-session">NAME          READY   STATUS    RESTARTS   AGE
zookeeper<span class="hljs-number">-0</span>   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">1</span>          <span class="hljs-number">2</span>m20s
zookeeper<span class="hljs-number">-1</span>   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">99</span>s
zookeeper<span class="hljs-number">-2</span>   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">74</span>s
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="3-configuring-and-starting-logdevice"></a><a href="#3-configuring-and-starting-logdevice" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. Configuring and Starting LogDevice</h2>
<p>Once all the zookeeper pods are ready, we're ready to start installing the LogDevice cluster.</p>
<h3><a class="anchor" aria-hidden="true" id="fetching-the-k8s-specs"></a><a href="#fetching-the-k8s-specs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Fetching The K8s Specs</h3>
<pre><code class="hljs css language-shell-session">git <span class="hljs-keyword">clone</span> <span class="hljs-title">https</span>://github.com/facebookincubator/LogDevice.git
cd LogDevice/k8s
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="initial-logdevice-configuration"></a><a href="#initial-logdevice-configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Initial LogDevice Configuration</h3>
<p>If you used a different way to install zookeeper, make sure to update the zookeeper connection string in the server config file <code>config.json</code>. It should look something like this:</p>
<pre><code class="hljs css language-shell-session">$ <span class="hljs-keyword">cat</span> config.json  | <span class="hljs-keyword">grep</span> -A <span class="hljs-number">3</span> zookeeper
  <span class="hljs-string">"zookeeper"</span>: {
    <span class="hljs-string">"zookeeper_uri"</span>: <span class="hljs-string">"ip://zookeeper-0.zookeeper-headless:2181,zookeeper-1.zookeeper-headless:2181,zookeeper-2.zookeeper-headless:2181"</span>,
    <span class="hljs-string">"timeout"</span>: <span class="hljs-string">"30s"</span>
  }
}
</code></pre>
<p>By default, this spec installs a 3 nodes LogDevice cluster. If you want a bigger cluster, modify the <code>logdevice-statefulset.yaml</code> file, and increase the number of replicas to the number of nodes you want in the cluster. Also by default, we attach a 20GB persistent storage to the nodes, if you want more you can change that under the <code>volumeClaimTemplates</code> section.</p>
<p>Check out <a href="/docs/next/Config.html">our configuration docs</a> for more details about the configuration file.</p>
<h3><a class="anchor" aria-hidden="true" id="starting-the-cluster"></a><a href="#starting-the-cluster" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Starting the Cluster</h3>
<p>Once you're done configuring the cluster, you can deploy it using:</p>
<pre><code class="hljs css language-shell-session">$ kubectl apply -k .

configmap/logdevice-config created
configmap/nshards created
service/logdevice-<span class="hljs-keyword">admin</span>-<span class="hljs-keyword">server</span>-service created
service/logdevice created
deployment.apps/logdevice-<span class="hljs-keyword">admin</span>-<span class="hljs-keyword">server</span>-deployment created
statefulset.apps/logdevice created
</code></pre>
<p>This command will:</p>
<ul>
<li>Start all the nodes under a kubernetes StatefulSet.</li>
<li>Start a standalone admin server to administrate the cluster.</li>
<li>Store the config file in a ConfigMap and mount it to all the nodes.</li>
</ul>
<p>When you run <code>kubectl get pods</code>, you should see something like this:</p>
<pre><code class="hljs css language-shell-session">NAME                                                 READY   STATUS    RESTARTS   AGE
logdevice<span class="hljs-number">-0</span>                                          <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">2</span>m14s
logdevice<span class="hljs-number">-1</span>                                          <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">2</span>m2s
logdevice<span class="hljs-number">-2</span>                                          <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">118</span>s
logdevice-admin-server-deployment<span class="hljs-number">-6</span>cdf46cd6c-d7gkp   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">2</span>m14s
zookeeper<span class="hljs-number">-0</span>                                          <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">1</span>          <span class="hljs-number">13</span>m
zookeeper<span class="hljs-number">-1</span>                                          <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">12</span>m
zookeeper<span class="hljs-number">-2</span>                                          <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">12</span>m
</code></pre>
<blockquote>
<p>Tip: If you want to see the logs of one of the nodes run <code>kubectl logs logdevice-&lt;id&gt;</code>.</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="bootstrapping-the-cluster"></a><a href="#bootstrapping-the-cluster" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bootstrapping the Cluster</h3>
<p>Once all the logdevice pods are running and ready, you'll need to bootstrap the cluster to enable all the nodes. To do that, run:</p>
<pre><code class="hljs css language-shell-session">$ kubectl <span class="hljs-builtin-name">run</span> ldshell -it --rm <span class="hljs-attribute">--restart</span>=Never <span class="hljs-attribute">--image</span>=facebookincubator/logdevice -- \
   ldshell --admin-server-host logdevice-admin-server-service \
   nodes-config \
   bootstrap --metadata-replicate-across <span class="hljs-string">'NODE: 3'</span>
</code></pre>
<p>This will start a ldshell pod, that connects to the admin server and invokes the <code>nodes-config bootstrap</code> ldshell command and sets the metadata replication property of the cluster to be replicated across three different nodes (more on metadata logs <a href="/docs/next/Config.html#metadata-logs-metadata-logs">here</a>). On success, you should see something like:</p>
<pre><code class="hljs css language-shell-session">Logging <span class="hljs-keyword">to</span> /tmp/ldshell-amfk8ock<span class="hljs-built_in">
Logging </span>Level: <span class="hljs-builtin-name">WARNING</span>
Successfully bootstrapped the cluster
pod <span class="hljs-string">"ldshell"</span> deleted
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="4-managing-the-cluster"></a><a href="#4-managing-the-cluster" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4. Managing the Cluster</h2>
<h3><a class="anchor" aria-hidden="true" id="ldshell"></a><a href="#ldshell" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>LDShell</h3>
<p>Now the cluster should be up and running and ready to receive reads and writes. To be able to get an interactive <a href="/docs/next/administration/LDShell.html">ldshell</a> instance on this cluster run:</p>
<pre><code class="hljs css language-shell-session">$ kubectl <span class="hljs-builtin-name">run</span> ldshell -it --rm <span class="hljs-attribute">--restart</span>=Never <span class="hljs-attribute">--image</span>=facebookincubator/logdevice -- \
   ldshell --admin-server-host logdevice-admin-server-service
</code></pre>
<p>To check the state of the cluster, you can then run:</p>
<pre><code class="hljs css language-shell-session"><span class="hljs-symbol">root@</span>logdevice&gt; status
ID  NAME         PACKAGE     STATE          UPTIME  LOCATION    SEQ.   DATA HEALTH  STORAGE STATE  SHARD OP.   HEALTH STATUS
<span class="hljs-number">0</span>   logdevice<span class="hljs-number">-0</span>  ?:<span class="hljs-number">99.99</span><span class="hljs-number">.99</span>  ALIVE  <span class="hljs-number">13</span> minutes ago            ENABLED   HEALTHY(<span class="hljs-number">1</span>)  READ_WRITE(<span class="hljs-number">1</span>)  ENABLED(<span class="hljs-number">1</span>)     HEALTHY
<span class="hljs-number">1</span>   logdevice<span class="hljs-number">-1</span>  ?:<span class="hljs-number">99.99</span><span class="hljs-number">.99</span>  ALIVE  <span class="hljs-number">13</span> minutes ago            ENABLED   HEALTHY(<span class="hljs-number">1</span>)  READ_WRITE(<span class="hljs-number">1</span>)  ENABLED(<span class="hljs-number">1</span>)     HEALTHY
<span class="hljs-number">2</span>   logdevice<span class="hljs-number">-2</span>  ?:<span class="hljs-number">99.99</span><span class="hljs-number">.99</span>  ALIVE  <span class="hljs-number">13</span> minutes ago            ENABLED   HEALTHY(<span class="hljs-number">1</span>)  READ_WRITE(<span class="hljs-number">1</span>)  ENABLED(<span class="hljs-number">1</span>)     HEALTHY
Took <span class="hljs-number">9</span>ms
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="changing-cluster-configs"></a><a href="#changing-cluster-configs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Changing Cluster Configs</h3>
<p>If you want to edit the cluster config which is stored as a configmap, you can run:</p>
<pre><code class="hljs css language-shell-session">kubectl <span class="hljs-builtin-name">edit</span> configmaps logdevice-config
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="expanding-the-cluster"></a><a href="#expanding-the-cluster" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Expanding the Cluster</h3>
<p>If you want to add more nodes to the cluster you can either run:</p>
<pre><code class="hljs css language-shell-session">kubectl scale statefulsets logdevice --replicas=&lt;<span class="hljs-keyword">new</span><span class="hljs-type">_size</span>&gt;
statefulset.apps/logdevice scaled
</code></pre>
<p>Or you can modify the spec file, increase the number of replicas and then reapply it using <code>kubectl apply -k .</code>. You can then check if the pods are up by running <code>kubectl get pods</code>. Once the pods are started, they will auto register to the cluster and maintenance manager will enable them to be able to start serving traffic.</p>
<h3><a class="anchor" aria-hidden="true" id="shrinking-the-cluster"></a><a href="#shrinking-the-cluster" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Shrinking the Cluster</h3>
<p>To be able to safely remove a node from a cluster, you first need to drain it (move all the data on this node, to other nodes). Check the <a href="adminstration/maintenances.md#draining-a-couple-of-nodes">maintenance docs</a> to learn how to drain a node.</p>
<blockquote>
<p>Note: kubernetes only allows you to shrink nodes from the end, so the nodes with the highest IDs in their name are the ones that you should drain.</p>
</blockquote>
<p>Once the drain is done (maintenance state is COMPLETED), decrease the number of replicas to the desired number using the same commands from the expand sections. Once the pod is deleted, you can then remove the node from the config using the <code>nodes-config shrink</code> ldshell command.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/next/FirstCluster.html"><span class="arrow-prev">← </span><span>Creating your first cluster</span></a><a class="docs-next button" href="/docs/next/Config.html"><span>Cluster configuration</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#1-building-your-kubernetes-cluster">1. Building your Kubernetes Cluster</a></li><li><a href="#2-install-zookeeper">2. Install Zookeeper</a></li><li><a href="#3-configuring-and-starting-logdevice">3. Configuring and Starting LogDevice</a><ul class="toc-headings"><li><a href="#fetching-the-k8s-specs">Fetching The K8s Specs</a></li><li><a href="#initial-logdevice-configuration">Initial LogDevice Configuration</a></li><li><a href="#starting-the-cluster">Starting the Cluster</a></li><li><a href="#bootstrapping-the-cluster">Bootstrapping the Cluster</a></li></ul></li><li><a href="#4-managing-the-cluster">4. Managing the Cluster</a><ul class="toc-headings"><li><a href="#ldshell">LDShell</a></li><li><a href="#changing-cluster-configs">Changing Cluster Configs</a></li><li><a href="#expanding-the-cluster">Expanding the Cluster</a></li><li><a href="#shrinking-the-cluster">Shrinking the Cluster</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logdevice.svg" alt="LogDevice" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/Overview.html">Getting Started</a><a href="/docs/FirstCluster.html">Creating your first cluster</a><a href="/api/annotated.html">C++ API Reference</a></div><div><h5>Community</h5><a href="https://facebook.com/groups/logdevice.oss/">LogDevice Users Group</a><a href="http://stackoverflow.com/questions/tagged/logdevice" target="_blank" rel="noreferrer noopener">Stack Overflow</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/facebookincubator/LogDevice">GitHub</a></div><div><h5>Legal</h5><a href="https://opensource.facebook.com/legal/privacy/" alt="Privacy" target="_blank" rel="noreferrer noopener">Privacy</a><a href="https://opensource.facebook.com/legal/terms/" alt="Terms" target="_blank" rel="noreferrer noopener">Terms</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2020 Facebook</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'f0ece773627cb7003a57c0edd6ec7dd8',
                indexName: 'logdevice',
                inputSelector: '#search_input_react'
              });
            </script></body></html>