<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Cluster configuration · LogDevice</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="The main config file passed to LogDevice server through the `--config-path` command line argument."/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Cluster configuration · LogDevice"/><meta property="og:type" content="website"/><meta property="og:url" content="https://logdevice.io/index.html"/><meta property="og:description" content="The main config file passed to LogDevice server through the `--config-path` command line argument."/><meta property="og:image" content="https://logdevice.io/img/logdevice_og.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://logdevice.io/img/logdevice.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css"/><link rel="alternate" type="application/atom+xml" href="https://logdevice.io/blog/atom.xml" title="LogDevice Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://logdevice.io/blog/feed.xml" title="LogDevice Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-137238014-1', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,700"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/facebook_logdevice_whitewordmark.png" alt="LogDevice"/></a><a href="/versions.html"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/next/Overview.html" target="_self">Docs</a></li><li class=""><a href="/api/annotated.html" target="_self">API</a></li><li class=""><a href="/help.html" target="_self">Support</a></li><li class=""><a href="https://github.com/facebookincubator/LogDevice" target="_self">GitHub</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Configuration</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Getting started<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/Overview.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/next/LocalCluster.html">Quickstart</a></li><li class="navListItem"><a class="navItem" href="/docs/next/Concepts.html">Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/next/Installation.html">Build LogDevice</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Configuration<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/FirstCluster.html">Creating your first cluster</a></li><li class="navListItem"><a class="navItem" href="/docs/next/Kubernetes.html">Running on Kubernetes</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/next/Config.html">Cluster configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/next/Settings.html">Settings</a></li><li class="navListItem"><a class="navItem" href="/docs/next/Logs.html">Log configuration</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Administration<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/administration/AdminServer.html">Admin Server (Control Plane)</a></li><li class="navListItem"><a class="navItem" href="/docs/next/administration/LDShell.html">LogDevice Shell</a></li><li class="navListItem"><a class="navItem" href="/docs/next/administration/LDQuery.html">LDQuery</a></li><li class="navListItem"><a class="navItem" href="/docs/next/administration/ClusterMaintenance.html">Cluster Maintenance</a></li><li class="navListItem"><a class="navItem" href="/docs/next/administration/SafetyChecker.html">Operations Safety Checker</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Concepts<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/Writepath.html">Write path</a></li><li class="navListItem"><a class="navItem" href="/docs/next/ReadPath.html">Read path</a></li><li class="navListItem"><a class="navItem" href="/docs/next/Terminology.html">Terminology</a></li><li class="navListItem"><a class="navItem" href="/docs/next/Consensus.html">Distributed consensus</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Designs<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/FailureDetection.html">Failure detection</a></li><li class="navListItem"><a class="navItem" href="/docs/next/Replication.html">Log replication configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/next/Recovery.html">Recovery after the failure of a sequencer</a></li><li class="navListItem"><a class="navItem" href="/docs/next/TrafficShaping.html">Traffic shaping</a></li><li class="navListItem"><a class="navItem" href="/docs/next/Rebuilding.html">Rebuilding</a></li><li class="navListItem"><a class="navItem" href="/docs/next/LogsDB.html">LogsDB</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">API<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/API_Introduction.html">Client library API</a></li><li class="navListItem"><a class="navItem" href="/docs/next/API_Doxygen.html">Reference</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Extending LogDevice<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/next/WritingPlugins.html">Writing plugins</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Cluster configuration</h1></header><article><div><span><p>The main config file passed to LogDevice server through the <code>--config-path</code> command line argument.
The same file can be used to create a client, for which it is passed in the constructor.</p>
<p>A simple config file structure looks as follows:</p>
<pre><code class="hljs">{
  <span class="hljs-attr">"client_settings"</span>: {},
  <span class="hljs-attr">"server_settings"</span>: {},
  <span class="hljs-attr">"cluster"</span>: <span class="hljs-string">"your_cluster_name"</span>,
  <span class="hljs-attr">"internal_logs"</span>: {},
  <span class="hljs-attr">"zookeeper"</span>: {}
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="cluster-cluster"></a><a href="#cluster-cluster" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cluster (<code>cluster</code>)</h2>
<p>The cluster name is used for handshaking between clients and servers. This will enforce that clients and servers use a config file with the same cluster identifier. It is also used as part of the path of znodes in ZooKeeper, so make sure this is different for every tier.</p>
<h2><a class="anchor" aria-hidden="true" id="internal-logs-internal_logs"></a><a href="#internal-logs-internal_logs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Internal logs (<code>internal_logs</code>)</h2>
<p>Internal logs are used for:</p>
<ul>
<li>Logs configuration</li>
<li>Event log</li>
<li>Maintenances</li>
</ul>
<p>Both of these have a delta and and snapshot log. Their log ranges are hard-coded.
Since a lot of LogDevice internals depend on these logs, you want higher fault-tolerance than normal data logs.</p>
<pre><code class="hljs"><span class="hljs-attr">"internal_logs":</span> <span class="hljs-string">{</span>
    <span class="hljs-attr">"config_log_deltas":</span> <span class="hljs-string">{</span>
        <span class="hljs-attr">"extra_copies":</span> <span class="hljs-number">0</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"max_writes_in_flight":</span> <span class="hljs-number">2000</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"nodeset_size":</span> <span class="hljs-number">20</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"replicate_across":</span> <span class="hljs-string">{</span>
            <span class="hljs-attr">"node":</span> <span class="hljs-number">6</span><span class="hljs-string">,</span>
            <span class="hljs-attr">"rack":</span> <span class="hljs-number">3</span>
        <span class="hljs-string">},</span>
        <span class="hljs-attr">"scd_enabled":</span> <span class="hljs-literal">false</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"synced_copies":</span> <span class="hljs-number">0</span>
    <span class="hljs-string">},</span>
    <span class="hljs-attr">"config_log_snapshots":</span> <span class="hljs-string">{</span>
        <span class="hljs-attr">"extra_copies":</span> <span class="hljs-number">0</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"max_writes_in_flight":</span> <span class="hljs-number">2000</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"nodeset_size":</span> <span class="hljs-number">20</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"replicate_across":</span> <span class="hljs-string">{</span>
            <span class="hljs-attr">"node":</span> <span class="hljs-number">6</span><span class="hljs-string">,</span>
            <span class="hljs-attr">"rack":</span> <span class="hljs-number">3</span>
        <span class="hljs-string">},</span>
        <span class="hljs-attr">"scd_enabled":</span> <span class="hljs-literal">false</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"synced_copies":</span> <span class="hljs-number">0</span>
    <span class="hljs-string">},</span>
    <span class="hljs-attr">"event_log_deltas":</span> <span class="hljs-string">{</span>
        <span class="hljs-attr">"extra_copies":</span> <span class="hljs-number">0</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"max_writes_in_flight":</span> <span class="hljs-number">2000</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"nodeset_size":</span> <span class="hljs-number">20</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"replicate_across":</span> <span class="hljs-string">{</span>
            <span class="hljs-attr">"node":</span> <span class="hljs-number">6</span><span class="hljs-string">,</span>
            <span class="hljs-attr">"rack":</span> <span class="hljs-number">3</span>
        <span class="hljs-string">},</span>
        <span class="hljs-attr">"scd_enabled":</span> <span class="hljs-literal">false</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"synced_copies":</span> <span class="hljs-number">0</span>
    <span class="hljs-string">},</span>
    <span class="hljs-attr">"event_log_snapshots":</span> <span class="hljs-string">{</span>
        <span class="hljs-attr">"extra_copies":</span> <span class="hljs-number">0</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"max_writes_in_flight":</span> <span class="hljs-number">2000</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"nodeset_size":</span> <span class="hljs-number">20</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"replicate_across":</span> <span class="hljs-string">{</span>
            <span class="hljs-attr">"node":</span> <span class="hljs-number">6</span><span class="hljs-string">,</span>
            <span class="hljs-attr">"rack":</span> <span class="hljs-number">3</span>
        <span class="hljs-string">},</span>
        <span class="hljs-attr">"scd_enabled":</span> <span class="hljs-literal">false</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"synced_copies":</span> <span class="hljs-number">0</span>
    <span class="hljs-string">}</span>
    <span class="hljs-attr">"maintenance_log_deltas":</span> <span class="hljs-string">{</span>
        <span class="hljs-attr">"extra_copies":</span> <span class="hljs-number">0</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"max_writes_in_flight":</span> <span class="hljs-number">2000</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"nodeset_size":</span> <span class="hljs-number">20</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"replicate_across":</span> <span class="hljs-string">{</span>
            <span class="hljs-attr">"node":</span> <span class="hljs-number">6</span><span class="hljs-string">,</span>
            <span class="hljs-attr">"rack":</span> <span class="hljs-number">3</span>
        <span class="hljs-string">},</span>
        <span class="hljs-attr">"scd_enabled":</span> <span class="hljs-literal">false</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"synced_copies":</span> <span class="hljs-number">0</span>
    <span class="hljs-string">},</span>
    <span class="hljs-attr">"maintenance_log_snapshots":</span> <span class="hljs-string">{</span>
        <span class="hljs-attr">"extra_copies":</span> <span class="hljs-number">0</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"max_writes_in_flight":</span> <span class="hljs-number">2000</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"nodeset_size":</span> <span class="hljs-number">20</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"replicate_across":</span> <span class="hljs-string">{</span>
            <span class="hljs-attr">"node":</span> <span class="hljs-number">6</span><span class="hljs-string">,</span>
            <span class="hljs-attr">"rack":</span> <span class="hljs-number">3</span>
        <span class="hljs-string">},</span>
        <span class="hljs-attr">"scd_enabled":</span> <span class="hljs-literal">false</span><span class="hljs-string">,</span>
        <span class="hljs-attr">"synced_copies":</span> <span class="hljs-number">0</span>
    <span class="hljs-string">}</span>
<span class="hljs-string">},</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="metadata-logs-metadata-logs"></a><a href="#metadata-logs-metadata-logs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Metadata logs (<code>metadata logs</code>)</h2>
<p>Metadata log configuration requires an explicit nodeset. This nodeset is crucial
to the system and should always be read and write available. Metadata nodeset is
dynamically reconfigured by the <a href="/docs/next/administration/AdminServer.html#the-maintenance-manager">Maintenance
Manager</a> and the
replication property cannot be modified after the initial bootstrapping of the
server via ldshell.</p>
<pre><code class="hljs css language-shell-session">ldshell -s localhost nodes-<span class="hljs-built_in">config</span> <span class="hljs-keyword">bootstrap </span>--metadata-replicate-across=<span class="hljs-string">"node:3"</span>
</code></pre>
<p>The metadata nodeset should contain as many failure domains as possible to ensure availability.</p>
<h2><a class="anchor" aria-hidden="true" id="nodes-nodes"></a><a href="#nodes-nodes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Nodes (<code>nodes</code>)</h2>
<p>The nodes configuration is dynamically stored in Zookeeper should not be
modified directly, however, <code>ldshell nodes-config edit</code> command is available in
case of emergency.</p>
<p>LogDevice nodes register themselves dynamically into the cluster on startup
using a feature that's enabled by the server setting
<code>--enable-node-self-registration</code>. In general, we strongly advise that you
include it always in your configuration file.</p>
<pre><code class="hljs"><span class="hljs-string">"server_settings"</span>: {
  <span class="hljs-string">"enable-node-self-registration"</span>: <span class="hljs-string">"true"</span>,
  <span class="hljs-string">"enable-nodes-configuration-manager"</span>: <span class="hljs-string">"true"</span>,
  <span class="hljs-string">"enable-cluster-maintenance-state-machine"</span>: <span class="hljs-string">"true"</span>,
  <span class="hljs-string">"use-nodes-configuration-manager-nodes-configuration"</span>: <span class="hljs-string">"true"</span>
},
<span class="hljs-string">"client_settings"</span>: {
  <span class="hljs-string">"enable-nodes-configuration-manager"</span>: <span class="hljs-string">"true"</span>,
  <span class="hljs-string">"use-nodes-configuration-manager-nodes-configuration"</span>: <span class="hljs-string">"true"</span>,
  <span class="hljs-string">"admin-client-capabilities"</span>: <span class="hljs-string">"true"</span>
}
</code></pre>
<p>The following is a comprehensive example on <code>logdeviced</code> arguments that can be
used to configure the node on startup</p>
<pre><code class="hljs css language-shell-session">logdeviced \
    <span class="hljs-comment"># required arguments</span>
    <span class="hljs-params">--config-path</span> &lt;path&gt; \
    <span class="hljs-params">--name</span> &lt;node-name&gt; \ <span class="hljs-comment"># must be unique in the cluster</span>
    <span class="hljs-params">--address</span> &lt;IP Address&gt; \ <span class="hljs-comment"># Used by others to connect to this node</span>
    <span class="hljs-params">--local-log-store-path</span> <span class="hljs-string">/data/logdevice</span> \ <span class="hljs-comment"># Where should we store data</span>
    <span class="hljs-comment"># optional arguments</span>
    <span class="hljs-params">--roles</span> storage,sequencer
    <span class="hljs-params">--port</span> 4440
    <span class="hljs-params">--gossip-port</span> 4441
    <span class="hljs-params">--admin-port</span> 6440
    <span class="hljs-params">--location</span> us1.west1
    <span class="hljs-params">--storage-capacity</span> 1
    <span class="hljs-params">--sequencer-weight</span> 1
    <span class="hljs-params">--num-shards</span> 1 <span class="hljs-comment"># MUST be the same value for all nodes in the cluster</span>
</code></pre>
<p>The self-registration works by first looking up the nodes configuration by
node <code>name</code>. If the node exists, then the rest of the properties of the node
will be updated from the supplied command-line arguments. If the node <code>name</code>
is new, a new <a href="#node-id-node_id">Node ID</a> is automatically assigned to this node
and the cluster will automatically expand to include this node.</p>
<blockquote>
<p>Note that the newly added node will by default be added with the state
<code>PROVISIONING</code> until the daemon finishes its self-test on startup, then the
state will be <code>NONE</code>. The <a href="/docs/next/administration/AdminServer.html#the-maintenance-manager">Maintenance
Manager</a> will notice
that we have a newly added node to the cluster and since there are no
maintenances applied, it will drive its operational state to <code>ENABLED</code>. Only
then it will start receiving reads and writes.</p>
</blockquote>
<p>Nodes can be removed from the cluster <strong>only</strong> if the have a <code>COMPLETED</code>
maintenance that sets all the shards of that node to <code>DRAINED</code>. See
<a href="/docs/next/administration/ClusterMaintenance.html">Cluster Maintenance</a> for reference.</p>
<h3><a class="anchor" aria-hidden="true" id="node-id-node_id"></a><a href="#node-id-node_id" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Node ID (<code>node_id</code>)</h3>
<p>A unique identifier for a node. This should not be changed during the lifetime
of a host. The nodes ID is sometime referred to as the <code>node-index</code>, this is
particularly true in ldshell. You may also see this is written in the format
<code>N0</code> where <code>0</code> is the <code>node-index</code>/<code>node_id</code>. We also use this notation in cases
where referencing a certain shard is necessary. In that case you will see
something like this <code>N0:S0</code>. This is shard <code>0</code> of node <code>0</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="location-location"></a><a href="#location-location" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Location (<code>location</code>)</h3>
<p>Location is used to encode the failure domain of a the host. This is used for data placement, based on the <a href="/docs/next/Logs.html">log configuration</a></p>
<p>The format of the string is: <code>region.datacenter.cluster.row.rack</code>.
As an example, a log configuration using:</p>
<pre><code class="hljs"><span class="hljs-attr">"replicate_across":</span> <span class="hljs-string">{</span>
      <span class="hljs-attr">"rack":</span> <span class="hljs-number">3</span>
<span class="hljs-string">}</span>
</code></pre>
<p>can be placed on machines with 3 different rack identifiers (but could share same <code>region.datacenter.cluster.row</code>):</p>
<ul>
<li><code>00.00.00.00.01</code></li>
<li><code>00.00.00.00.02</code></li>
<li><code>00.00.00.00.03</code></li>
</ul>
<p>Each section can be expressed as a string.</p>
<h3><a class="anchor" aria-hidden="true" id="roles-and-state-roles-sequencer-sequencer_weight-storage-and-storage_weight"></a><a href="#roles-and-state-roles-sequencer-sequencer_weight-storage-and-storage_weight" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Roles and state (<code>roles</code>, <code>sequencer</code>, <code>sequencer_weight</code>, <code>storage</code> and <code>storage_weight</code>)</h3>
<p>A distinction should be made between roles and state:</p>
<ul>
<li>Role: this remains the same during the lifetime of the node.</li>
<li>State: could change (for e.g. maintenance operations)</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="roles--permanent-properties"></a><a href="#roles--permanent-properties" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Roles / permanent properties</h4>
<p><code>roles</code> is defined as a list, and can combine the following options:</p>
<ul>
<li><code>sequencer</code></li>
<li><code>storage</code></li>
</ul>
<p><code>storage-capacity</code> defines a proportional value for the amount of data to be stored compared to other machines. When e.g. total disk size is used as weight for machines with variable disk sizes, the storage will be used proportionally.
<code>sequencer-weight</code> can similarly define a proportional value for the number of sequencers to be placed on the machine.</p>
<h3><a class="anchor" aria-hidden="true" id="gossip-port-gossip_port"></a><a href="#gossip-port-gossip_port" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Gossip port (<code>gossip_port</code>)</h3>
<p>The (TCP) port LogDevice uses to gossip node state internally. This is required when <code>gossip-enabled</code> is <code>true</code>.
Gossip is only used between nodes and is not required to be exposed to clients.</p>
<h2><a class="anchor" aria-hidden="true" id="zookeeper-settings-zookeeper"></a><a href="#zookeeper-settings-zookeeper" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Zookeeper settings (<code>zookeeper</code>)</h2>
<pre><code class="hljs"><span class="hljs-string">"zookeeper"</span>: {
    <span class="hljs-string">"zookeeper_uri"</span>: <span class="hljs-string">"ip://192.168.0.5:2181,192.168.0.6:2181"</span>,
    <span class="hljs-string">"timeout"</span>: <span class="hljs-string">"30s"</span>
}
</code></pre>
<ul>
<li><code>zookeeper_uri</code> defines the list of IP/Name+port pairs of the Zookeeper nodes. For IPv6, square brackets can be used (e.g.<code>[::1]:2183</code>)</li>
<li><code>timeout</code> defines the connection timeout.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="settings-client_settings-and-server_settings"></a><a href="#settings-client_settings-and-server_settings" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Settings (<code>client_settings</code> and <code>server_settings</code>)</h2>
<p>Please check the <a href="/docs/next/Settings.html">settings documentation</a> for a detailed explanation on all the settings.</p>
<p>Settings are expressed as key-value pairs in both <code>client_settings</code> and <code>server_settings</code>.
For boolean-like values, any of the following can be used:</p>
<ul>
<li><code>1</code>, <code>true</code>, <code>True</code></li>
<li><code>0</code>, <code>false</code>, <code>False</code></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="traffic-shaping-traffic_shaping"></a><a href="#traffic-shaping-traffic_shaping" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Traffic shaping (<code>traffic_shaping</code>)</h2>
<p>See <a href="/docs/next/TrafficShaping.html">Traffic Shaping</a> detailed documentation on how to configure this.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/next/Kubernetes.html"><span class="arrow-prev">← </span><span>Running on Kubernetes</span></a><a class="docs-next button" href="/docs/next/Settings.html"><span>Settings</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#cluster-cluster">Cluster (<code>cluster</code>)</a></li><li><a href="#internal-logs-internal_logs">Internal logs (<code>internal_logs</code>)</a></li><li><a href="#metadata-logs-metadata-logs">Metadata logs (<code>metadata logs</code>)</a></li><li><a href="#nodes-nodes">Nodes (<code>nodes</code>)</a><ul class="toc-headings"><li><a href="#node-id-node_id">Node ID (<code>node_id</code>)</a></li><li><a href="#location-location">Location (<code>location</code>)</a></li><li><a href="#roles-and-state-roles-sequencer-sequencer_weight-storage-and-storage_weight">Roles and state (<code>roles</code>, <code>sequencer</code>, <code>sequencer_weight</code>, <code>storage</code> and <code>storage_weight</code>)</a></li><li><a href="#gossip-port-gossip_port">Gossip port (<code>gossip_port</code>)</a></li></ul></li><li><a href="#zookeeper-settings-zookeeper">Zookeeper settings (<code>zookeeper</code>)</a></li><li><a href="#settings-client_settings-and-server_settings">Settings (<code>client_settings</code> and <code>server_settings</code>)</a></li><li><a href="#traffic-shaping-traffic_shaping">Traffic shaping (<code>traffic_shaping</code>)</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logdevice.svg" alt="LogDevice" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/Overview.html">Getting Started</a><a href="/docs/FirstCluster.html">Creating your first cluster</a><a href="/api/annotated.html">C++ API Reference</a></div><div><h5>Community</h5><a href="https://facebook.com/groups/logdevice.oss/">LogDevice Users Group</a><a href="http://stackoverflow.com/questions/tagged/logdevice" target="_blank" rel="noreferrer noopener">Stack Overflow</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/facebookincubator/LogDevice">GitHub</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2020 Facebook</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'f0ece773627cb7003a57c0edd6ec7dd8',
                indexName: 'logdevice',
                inputSelector: '#search_input_react'
              });
            </script></body></html>