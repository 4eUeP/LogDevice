<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Creating your first cluster · LogDevice</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;h2&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;1-provision-the-servers&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#1-provision-the-servers&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1. Provision the servers&lt;/h2&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Creating your first cluster · LogDevice"/><meta property="og:type" content="website"/><meta property="og:url" content="https://logdevice.io/index.html"/><meta property="og:description" content="&lt;h2&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;1-provision-the-servers&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#1-provision-the-servers&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1. Provision the servers&lt;/h2&gt;
"/><meta property="og:image" content="https://logdevice.io/img/logdevice_og.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://logdevice.io/img/logdevice.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://logdevice.io/blog/atom.xml" title="LogDevice Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://logdevice.io/blog/feed.xml" title="LogDevice Blog RSS Feed"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/facebook_logdevice_whitewordmark.png" alt="LogDevice"/></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/Overview.html" target="_self">Docs</a></li><li class=""><a href="/api/annotated.html" target="_self">API</a></li><li class=""><a href="/help.html" target="_self">Support</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Configuration</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting started</h3><ul><li class="navListItem"><a class="navItem" href="/docs/Overview.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/Concepts.html">Concepts and architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/Terminology.html">Terminology</a></li><li class="navListItem"><a class="navItem" href="/docs/Installation.html">Installation</a></li><li class="navListItem"><a class="navItem" href="/docs/LocalCluster.html">Running a local cluster</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Configuration</h3><ul><li class="navListItem navListItemActive"><a class="navItem" href="/docs/FirstCluster.html">Creating your first cluster</a></li><li class="navListItem"><a class="navItem" href="/docs/Config.html">Cluster configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/Settings.html">Settings</a></li><li class="navListItem"><a class="navItem" href="/docs/Logs.html">Log configuration</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Administration</h3><ul><li class="navListItem"><a class="navItem" href="/docs/LDShell.html">LogDevice Shell</a></li><li class="navListItem"><a class="navItem" href="/docs/LDQuery.html">LDQuery</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">API</h3><ul><li class="navListItem"><a class="navItem" href="/docs/API_Intro.html">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/API_Doxygen.html">Reference</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Extending LogDevice</h3><ul><li class="navListItem"><a class="navItem" href="/docs/WritingPlugins.html">Writing plugins</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Creating your first cluster</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="1-provision-the-servers"></a><a href="#1-provision-the-servers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. Provision the servers</h2>
<p>The recommended minimum for running a fully functional LogDevice cluster is 4 servers. If you want to try out LogDevice on a single machine for development/experimental purposes, you can follow a much simpler process to <a href="/docs/LocalCluster.html">run a local cluster</a> instead.</p>
<p>Each LogDevice server should have at least 4GB of RAM. For best results the network latency between the servers in the cluster should be low.</p>
<p>The only platform currently supported is Ubuntu 18 LTS &quot;Bionic Beaver&quot;.</p>
<p>Make sure that network ports specified in the config (<code>16111</code> and <code>16112</code> for the config file listed below) and the command port (<code>5440</code> by default, it's also the only value currently supported by <code>ldshell</code>) are open. Also, the nodes have to be able to communicate with ZooKeeper (see below).</p>
<p><strong>Note:</strong> the setup steps in this simple tutorial will setup a cluster without any security controls. You should restrict network access to these ports using other means (like a firewall or NAT), otherwise your cluster will be open for the world to use.</p>
<h2><a class="anchor" aria-hidden="true" id="2-set-up-a-zookeeper-ensemble"></a><a href="#2-set-up-a-zookeeper-ensemble" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. Set up a ZooKeeper ensemble</h2>
<p>LogDevice requires ZooKeeper in order to store minimal per-log metadata accessed during sequencer activation and failover.  ZooKeeper can also be used as a mechanism for distributing the config file (see the <a href="#5-create-a-configuration-file">Configuration section</a> below).</p>
<p>You can re-use an existing ZooKeeper ensemble, or create a new one. Different LogDevice clusters can use the same ZooKeeper ensemble as long as they have a different value of the <code>cluster</code> attribute in the LogDevice configuration file.</p>
<p>You can run ZooKeeper on the same machines as LogDevice or on separate hardware. For best results, latency from the LogDevice cluster to the ZooKeeper ensemble should be minimal. However, LogDevice doesn't communicate with ZooKeeper outside of config loading / sequencer activation / failover scenarios, so having higher latency to ZooKeeper shouldn't affect performance in steady state.</p>
<p>You can find a tutorial online on how to set up a proper Zookeeper ensemble. Note that if the metadata in the ZooKeeper ensemble is lost, the data in the cluster will be corrupted and unreadable.</p>
<h4><a class="anchor" aria-hidden="true" id="unsafe-single-node-zookeeper-setup-on-ubuntu"></a><a href="#unsafe-single-node-zookeeper-setup-on-ubuntu" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Unsafe single-node ZooKeeper setup on Ubuntu</h4>
<p>If you are just setting up a test LogDevice cluster and are OK with it becoming unusable and losing all your data if you lose your ZooKeeper node, you can set up a single-node Zookeeper ensemble easily on Ubuntu by running this:</p>
<pre><code class="hljs css language-sh">sudo apt-get update &amp;&amp; sudo apt-get install zookeeper zookeeperd
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="3-build-logdevice-and-distribute-it-to-the-machines"></a><a href="#3-build-logdevice-and-distribute-it-to-the-machines" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. Build LogDevice and distribute it to the machines</h2>
<p>You can follow the steps on the <a href="/docs/Installation.html">Installation page</a> to see how LogDevice should be built and installed.</p>
<p>If you are building binaries on one machine and distributing them to the others, make sure every server has dependencies installed. On Ubuntu, you can run this from the root of the git checkout to install them:</p>
<pre><code class="hljs css language-sh">sudo apt-get update &amp;&amp; sudo apt-get install -y $(cat logdevice/build_tools/ubuntu.deps)
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="4-create-data-folders-on-storage-nodes"></a><a href="#4-create-data-folders-on-storage-nodes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4. Create data folders on storage nodes</h2>
<p>Storage nodes store data in shards. Typically each shard maps to a different physical disk. The example commands below create a user and a typical folder structure for logdevice, and should be run on each storage node. They assume that your data disk is mounted on <code>/mnt/data0</code>. The recommended filesystem to be used for data storage in LogDevice is XFS.</p>
<pre><code class="hljs css language-sh"><span class="hljs-comment"># creates the root folder for data</span>
sudo mkdir -p /data/logdevice/

<span class="hljs-comment"># writes the number of shards that this box will have</span>
<span class="hljs-built_in">echo</span> 1 | sudo tee /data/logdevice/NSHARDS

<span class="hljs-comment"># creates symlink for shard 0</span>
sudo ln -s /mnt/data0 /data/logdevice/shard0

<span class="hljs-comment"># Adds the user for the logdevice daemon</span>
sudo useradd logdevice

<span class="hljs-comment"># changes ownership for the data directory and the disk</span>
sudo chown -R logdevice /data/logdevice/
sudo chown -R logdevice /mnt/data0/
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="5-create-a-configuration-file"></a><a href="#5-create-a-configuration-file" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5. Create a configuration file</h2>
<p>An example of a minimal configuration file for 4 nodes and a 3-node ZooKeeper ensemble hosted on the same machine can be found below (and is also included in the source tree under <code>logdevice/examples/logdevice.conf</code>).</p>
<p>Modify it to adapt it to your situation and save it to a file somewhere (e.g. <code>~/logdevice_test.conf</code>). The parts that you need to modify are:</p>
<ol>
<li><code>host</code> attribute for every node. It should be an <code>IPv4:port</code> or <code>[IPv6]:port</code> pair, hostnames are not supported.</li>
<li><code>quorum</code> in the <code>zookeeper</code> section - list of ZooKeeper ensemble nodes and ports.</li>
<li>(optional) The <code>cluster</code> attribute if you are creating several clusters - it has to be unique for each cluster sharing a ZooKeeper ensemble!</li>
<li>(optional) <code>gossip_port</code> for every node if you intend to use a different one.</li>
<li>(optional) <code>num_shards</code> for every node if you intend to use more than one disk for data on that machine.</li>
</ol>
<p>If you are adding more nodes to the cluster, make sure they all have unique <code>node_id</code> values and consider expanding the <code>nodeset</code> under the <code>metadata_logs</code> section to include them as well.</p>
<p>Detailed explanations of all the attributes can be found in the <a href="/docs/Config.html">Cluster configuration</a> docs.</p>
<pre><code class="hljs css language-js">{
    <span class="hljs-string">"cluster"</span>: <span class="hljs-string">"test"</span>,
    <span class="hljs-string">"nodes"</span>: [
        {
            <span class="hljs-string">"node_id"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"host"</span>: <span class="hljs-string">"10.0.0.1:16111"</span>,
            <span class="hljs-string">"gossip_port"</span>: <span class="hljs-number">16112</span>,
            <span class="hljs-string">"generation"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"roles"</span>: [ <span class="hljs-string">"sequencer"</span>, <span class="hljs-string">"storage"</span> ],
            <span class="hljs-string">"sequencer"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"storage"</span>: <span class="hljs-string">"read-write"</span>,
            <span class="hljs-string">"num_shards"</span>: <span class="hljs-number">1</span>
        },
        {
            <span class="hljs-string">"node_id"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"host"</span>: <span class="hljs-string">"10.0.0.2:16111"</span>,
            <span class="hljs-string">"gossip_port"</span>: <span class="hljs-number">16112</span>,
            <span class="hljs-string">"generation"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"roles"</span>: [ <span class="hljs-string">"sequencer"</span>, <span class="hljs-string">"storage"</span> ],
            <span class="hljs-string">"sequencer"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"storage"</span>: <span class="hljs-string">"read-write"</span>,
            <span class="hljs-string">"num_shards"</span>: <span class="hljs-number">1</span>
        },
        {
            <span class="hljs-string">"node_id"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-string">"host"</span>: <span class="hljs-string">"10.0.0.3:16111"</span>,
            <span class="hljs-string">"gossip_port"</span>: <span class="hljs-number">16112</span>,
            <span class="hljs-string">"generation"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"roles"</span>: [ <span class="hljs-string">"sequencer"</span>, <span class="hljs-string">"storage"</span> ],
            <span class="hljs-string">"sequencer"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"storage"</span>: <span class="hljs-string">"read-write"</span>,
            <span class="hljs-string">"num_shards"</span>: <span class="hljs-number">1</span>
        },
        {
            <span class="hljs-string">"node_id"</span>: <span class="hljs-number">3</span>,
            <span class="hljs-string">"host"</span>: <span class="hljs-string">"10.0.0.4:16111"</span>,
            <span class="hljs-string">"gossip_port"</span>: <span class="hljs-number">16112</span>,
            <span class="hljs-string">"generation"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"roles"</span>: [ <span class="hljs-string">"sequencer"</span>, <span class="hljs-string">"storage"</span> ],
            <span class="hljs-string">"sequencer"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"storage"</span>: <span class="hljs-string">"read-write"</span>,
            <span class="hljs-string">"num_shards"</span>: <span class="hljs-number">1</span>
        }
    ],
    <span class="hljs-string">"internal_logs"</span>: {
        <span class="hljs-string">"config_log_deltas"</span>: {
            <span class="hljs-string">"replicate_across"</span>: {
                <span class="hljs-string">"node"</span>: <span class="hljs-number">3</span>
            }
        },
        <span class="hljs-string">"config_log_snapshots"</span>: {
            <span class="hljs-string">"replicate_across"</span>: {
                <span class="hljs-string">"node"</span>: <span class="hljs-number">3</span>
            }
        },
        <span class="hljs-string">"event_log_deltas"</span>: {
            <span class="hljs-string">"replicate_across"</span>: {
                <span class="hljs-string">"node"</span>: <span class="hljs-number">3</span>
            }
        },
        <span class="hljs-string">"event_log_snapshots"</span>: {
            <span class="hljs-string">"replicate_across"</span>: {
                <span class="hljs-string">"node"</span>: <span class="hljs-number">3</span>
            }
        }
    },
    <span class="hljs-string">"metadata_logs"</span>: {
        <span class="hljs-string">"nodeset"</span>: [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>],
        <span class="hljs-string">"replicate_across"</span>: { <span class="hljs-string">"node"</span>: <span class="hljs-number">3</span> }
    },
    <span class="hljs-string">"zookeeper"</span>: {
        <span class="hljs-string">"quorum"</span>: [
            <span class="hljs-string">"10.0.0.1:2181"</span>,
            <span class="hljs-string">"10.0.0.2:2181"</span>,
            <span class="hljs-string">"10.0.0.3:2181"</span>
        ],
        <span class="hljs-string">"timeout"</span>: <span class="hljs-string">"30s"</span>
    }
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="6-store-the-configuration-file"></a><a href="#6-store-the-configuration-file" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>6. Store the configuration file</h2>
<p>All LogDevice nodes have to have access to the same configuration file when starting. They will monitor the file for changes and pick up (most) changes without being restarted, so ideally they should have access to it while running as well. There can be different ways to ensure this - e.g. one option is to store the file on a shared network filesystem. However, the simplest way is to store the configuration file in ZooKeeper.</p>
<p>You can save the config file you created to ZooKeeper by running the following (paths assumed from previous steps):</p>
<pre><code class="hljs css language-sh">/usr/share/zookeeper/bin/zkCli.sh create /logdevice_test.conf <span class="hljs-string">"`cat ~/logdevice_test.conf`"</span>
</code></pre>
<p>If you need to modify the config in ZooKeeper after you've created it, use the <code>set</code> command instead of <code>create</code>, like so:</p>
<pre><code class="hljs css language-sh">/usr/share/zookeeper/bin/zkCli.sh <span class="hljs-built_in">set</span> /logdevice_test.conf <span class="hljs-string">"`cat ~/logdevice_test.conf`"</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="7-optional-install-logdevice-as-a-service"></a><a href="#7-optional-install-logdevice-as-a-service" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>7. (optional) Install LogDevice as a service</h2>
<p>Under Ubuntu Bionic, you can install the service by populating <code>/etc/systemd/system/logdevice.service</code> on every node with this (note that you should change the zookeeper quorum to the one that holds your config, as well as the port and data storage path if they are different in your deployment):</p>
<pre><code class="hljs css language-text">[Unit]
Description=LogDevice

[Service]
ExecStart=/usr/local/bin/logdeviced --config-path zk:10.0.0.1:2181,10.0.0.2:2181,10.0.0.3:2181/logdevice_test.conf --port=16111 --local-log-store-path=/data/logdevice/
StandardError=journal
Restart=always
TimeoutStopSec=120
Type=simple
KillMode=process
User=logdevice

[Install]
WantedBy=multi-user.target
</code></pre>
<p>You can then enable the service by running this:</p>
<pre><code class="hljs css language-sh">sudo systemctl daemon-reload
sudo systemctl <span class="hljs-built_in">enable</span> logdevice
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="8-start-logdeviced-on-every-node"></a><a href="#8-start-logdeviced-on-every-node" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>8. Start logdeviced on every node</h2>
<p>If you used the instructions above to install a service, you can just run</p>
<pre><code class="hljs css language-sh">sudo systemctl start logdevice
</code></pre>
<p>If you didn't, you can start logdevice like this (substitute zookeeper quorum for the one that holds the config, and the port and data storage paths if you used different ones):</p>
<pre><code class="hljs css language-sh"><span class="hljs-built_in">cd</span> /data/logdevice/
sudo -u logdevice nohup /usr/<span class="hljs-built_in">local</span>/bin/logdeviced --config-path zk:10.0.0.1:2181,10.0.0.2:2181,10.0.0.3:2181/logdevice_test.conf --port=16111 --<span class="hljs-built_in">local</span>-log-store-path=/data/logdevice/ &amp;
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="9-check-it-s-running"></a><a href="#9-check-it-s-running" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>9. Check it's running</h2>
<p><code>ldshell</code> is a utility to introspect and mutate the state of LogDevice. One of its most powerful commands is <code>query</code>, which allows you to run SQL <code>SELECT</code> queries against <a href="/docs/LDQuery.html">various virtual SQL tables</a> that expose the state of the cluster and some of its internals. The following command queries the <code>info</code> table which will show you the start time of the nodes that are up, their pids and a couple more fields:</p>
<pre><code class="hljs css language-sh"><span class="hljs-comment"># export the config path (change the Zookeeper quorum to yours here) so it's available for subsequent commands</span>
<span class="hljs-built_in">export</span> LOGDEVICE_CONFIG=zk:10.0.0.1:2181,10.0.0.2:2181,10.0.0.3:2181/logdevice_test.conf
ldshell -c <span class="hljs-variable">$LOGDEVICE_CONFIG</span> query <span class="hljs-string">'SELECT * FROM info'</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="10-create-log-ranges-using-ldshell"></a><a href="#10-create-log-ranges-using-ldshell" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>10. Create log ranges using ldshell</h2>
<p>Before you can write any data to LogDevice logs, you need to create them. By default the cluster starts with an empty log list. To add a log range called <code>test_logs</code> with 100 logs where the data would be replicated across 2 nodes and trimmed after 3 days, run this command:</p>
<pre><code class="hljs css language-sh">ldshell -c <span class="hljs-variable">$LOGDEVICE_CONFIG</span> logs create --replicate-across <span class="hljs-string">"node: 2"</span> --backlog <span class="hljs-string">"259200s"</span> --from 1 --to 100 /test_logs
</code></pre>
<p>More information about managing your log configuration is available <a href="/docs/Logs.html">here</a></p>
<h2><a class="anchor" aria-hidden="true" id="11-write-data-into-a-log"></a><a href="#11-write-data-into-a-log" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>11. Write data into a log</h2>
<p>All ready to go! You can now write your first payload into log 1:</p>
<pre><code class="hljs css language-sh"><span class="hljs-built_in">echo</span> payload | ./LogDevice/_build/bin/ldwrite <span class="hljs-variable">$LOGDEVICE_CONFIG</span> -l 1
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="12-read-data-from-a-log"></a><a href="#12-read-data-from-a-log" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>12. Read data from a log</h2>
<p>This command will run the tailer for log 1. If you did the write above, it should print out &quot;payload&quot;:</p>
<pre><code class="hljs css language-sh">./LogDevice/_build/bin/ldtail <span class="hljs-variable">$LOGDEVICE_CONFIG</span> -l 1 --follow
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="all-done"></a><a href="#all-done" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>All done!</h2>
<p>Congratulations! Now you have a running LogDevice cluster! You can now read the <a href="/docs/API_Intro.html">Introduction to the API</a> to learn how to use it.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/LocalCluster.html"><span class="arrow-prev">← </span><span>Running a local cluster</span></a><a class="docs-next button" href="/docs/Config.html"><span>Cluster configuration</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#1-provision-the-servers">1. Provision the servers</a></li><li><a href="#2-set-up-a-zookeeper-ensemble">2. Set up a ZooKeeper ensemble</a></li><li><a href="#3-build-logdevice-and-distribute-it-to-the-machines">3. Build LogDevice and distribute it to the machines</a></li><li><a href="#4-create-data-folders-on-storage-nodes">4. Create data folders on storage nodes</a></li><li><a href="#5-create-a-configuration-file">5. Create a configuration file</a></li><li><a href="#6-store-the-configuration-file">6. Store the configuration file</a></li><li><a href="#7-optional-install-logdevice-as-a-service">7. (optional) Install LogDevice as a service</a></li><li><a href="#8-start-logdeviced-on-every-node">8. Start logdeviced on every node</a></li><li><a href="#9-check-it-s-running">9. Check it's running</a></li><li><a href="#10-create-log-ranges-using-ldshell">10. Create log ranges using ldshell</a></li><li><a href="#11-write-data-into-a-log">11. Write data into a log</a></li><li><a href="#12-read-data-from-a-log">12. Read data from a log</a></li><li><a href="#all-done">All done!</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logdevice.svg" alt="LogDevice" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/Overview.html">Getting Started</a><a href="/docs/FirstCluster.html">Creating your first cluster</a><a href="/api/annotated.html">C++ API Reference</a></div><div><h5>Community</h5><a href="https://facebook.com/groups/logdevice.oss/">LogDevice Users Group</a><a href="http://stackoverflow.com/questions/tagged/logdevice" target="_blank" rel="noreferrer noopener">Stack Overflow</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/facebookincubator/LogDevice">GitHub</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2019 Facebook</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'f0ece773627cb7003a57c0edd6ec7dd8',
                indexName: 'logdevice',
                inputSelector: '#search_input_react'
              });
            </script></body></html>